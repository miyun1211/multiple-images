<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>商品詳細</title>
    <style>
        /* ========================================
           基本設定とページ全体のスタイル
           ======================================== */
        body {
            margin: 0;
            font-family: sans-serif;
            background-color: #f4f4f4;
            color: #333;
        }

        /* ========================================
           商品ギャラリー全体のコンテナ
           ======================================== */
        .product-gallery {
            max-width: 960px;
            margin: 40px auto;
            background-color: #fff;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }

        /* ========================================
           メイン画像表示エリア
           ======================================== */
        /* メイン画像と矢印を囲むコンテナ */
        .main-image-container {
            position: relative;
            width: 100%;
            aspect-ratio: 1 / 1;
            overflow: hidden;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* メイン画像本体 */
        .main-image-container img {
            max-width: 100%;
            max-height: 100%;
            display: block;
            object-fit: contain;
            cursor: grab;
            /* 掴めるカーソル */
            transition: opacity 0.2s ease;
        }

        .main-image-container img:hover {
            opacity: 0.8;
        }

        /* メイン画像エリアの左右矢印 */
        .arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 44px;
            height: 44px;
            border-radius: 50%;
            /* 円形にする */
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            font-size: 1.8em;
            color: #666;
            background-color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            user-select: none;
            /* テキスト選択の無効化 */
            transition: background-color 0.3s ease, color 0.3s ease;
            z-index: 10;
        }

        .arrow:hover {
            background-color: rgba(0, 0, 0, 0.5);
            color: #fff;
        }

        .arrow.left {
            left: 10px;
        }

        .arrow.right {
            right: 10px;
        }


        /* ========================================
           サムネイル画像エリア
           ======================================== */
        /* サムネイル画像を囲むコンテナ */
        .thumbnail-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* サムネイル画像本体 */
        .thumbnail-container img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid transparent;
            border-radius: 4px;
            transition: border-color 0.2s ease, transform 0.2s ease;
        }

        .thumbnail-container img:hover {
            transform: translateY(-2px);
            /* ホバー時に少し浮き上がる */
        }

        /* 選択中のサムネイル */
        .thumbnail-container img.active {
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.5);
        }

        /* ========================================
           モーダルウィンドウ (拡大表示)
           ======================================== */
        /* モーダル全体の背景 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            /* 初期状態は非表示 */
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.modal-open {
            display: flex;
            /* このクラスが付くと表示される */
        }

        /* 拡大表示される画像 */
        .modal-content {
            max-width: 90vw;
            max-height: 80vh;
            object-fit: contain;
            cursor: grab;
            /* 掴めるカーソル */
        }

        /* 右上の閉じるボタン */
        .modal-close-button {
            position: absolute;
            top: 20px;
            right: 30px;
            color: #fff;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
            z-index: 1010;
        }

        .modal-close-button:hover {
            color: #bbb;
        }

        /* モーダル内の左右矢印 */
        .modal-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            font-size: 2.2em;
            color: #fff;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.3s ease, color 0.3s ease;
            z-index: 1010;
        }

        .modal-arrow:hover {
            background-color: rgba(0, 0, 0, 0.7);
        }

        .modal-arrow.left {
            left: 20px;
        }

        .modal-arrow.right {
            right: 20px;
        }

        /* ========================================
           モーダル内のページネーション (〇●〇)
           ======================================== */
        /* ドット全体を囲むコンテナ */
        .modal-pagination {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
        }

        /* 通常のドット (〇) */
        .pagination-dot {
            width: 12px;
            height: 12px;
            background-color: #888;
            border-radius: 50%;
            transition: background-color 0.3s ease;
            cursor: pointer;
        }

        /* 選択中のドット (●) */
        .pagination-dot.active {
            background-color: #fff;
        }
    </style>
</head>

<body>
    <!-- HTMLは変更なし -->
    <div class="product-gallery">
        <div class="main-image-container">
            <img id="mainImage" src="images/n1.jpg" alt="メイン画像">
            <div class="arrow left" onclick="changeMainImage(-1)">&#10094;</div>
            <div class="arrow right" onclick="changeMainImage(1)">&#10095;</div>
        </div>
        <div class="thumbnail-container">
            <img class="thumbnail active" src="images/n1.jpg" alt="サムネイル1" onclick="selectImage(this, 0)">
            <img class="thumbnail" src="images/n2.jpg" alt="サムネイル2" onclick="selectImage(this, 1)">
            <img class="thumbnail" src="images/n3.jpg" alt="サムネイル3" onclick="selectImage(this, 2)">
        </div>
    </div>
    <div id="modal" class="modal-overlay">
        <span id="closeButton" class="modal-close-button">&times;</span>
        <img id="modalImage" class="modal-content" src="" alt="拡大画像">
        <div id="modalArrowLeft" class="modal-arrow left">&#10094;</div>
        <div id="modalArrowRight" class="modal-arrow right">&#10095;</div>
        <div id="modalPagination" class="modal-pagination"></div>
    </div>


    <script>
        const mainImage = document.getElementById('mainImage');
        const thumbnails = document.querySelectorAll('.thumbnail');
        // JavaScript内の画像パスの配列
        const imageSources = [
            'images/n1.jpg',
            'images/n2.jpg',
            'images/n3.jpg'
        ];
        let currentIndex = 0;

        // サムネイルがクリックされたときにメイン画像を切り替える関数
        function selectImage(selectedThumbnail, index) {
            mainImage.src = imageSources[index];
            currentIndex = index;
            thumbnails.forEach(thumb => thumb.classList.remove('active'));
            selectedThumbnail.classList.add('active');
        }

        // 矢印がクリックされたときにメイン画像を切り替える関数
        function changeMainImage(direction) {
            currentIndex += direction;
            if (currentIndex < 0) {
                currentIndex = imageSources.length - 1;
            } else if (currentIndex >= imageSources.length) {
                currentIndex = 0;
            }
            mainImage.src = imageSources[currentIndex];
            // ★ 変更点: サムネイルのアクティブ表示も更新
            thumbnails.forEach((thumb, index) => {
                thumb.classList.toggle('active', index === currentIndex);
            });
        }

        // ページの読み込みが完了したときに最初の画像を選択状態にする
        window.addEventListener('load', () => {
            selectImage(thumbnails[0], 0);
        });

        /* --- ★ ここからモーダル用のJavaScriptを追加 --- */

        // 1. モーダル関連のHTML要素を取得
        const modal = document.getElementById('modal');
        const modalImage = document.getElementById('modalImage');
        const closeButton = document.getElementById('closeButton');

        // ★ 2. 追加したモーダル内の要素を取得
        const modalArrowLeft = document.getElementById('modalArrowLeft');
        const modalArrowRight = document.getElementById('modalArrowRight');
        const modalPagination = document.getElementById('modalPagination');

        // ★ 3. 最初に一度だけ、画像の数だけページネーションのドットを生成する
        imageSources.forEach((src, index) => {
            const dot = document.createElement('span');
            dot.classList.add('pagination-dot');
            dot.addEventListener('click', () => { jumpToImage(index); });
            modalPagination.appendChild(dot);
        });
        const paginationDots = document.querySelectorAll('.pagination-dot');

        /* ★ 変更点: 画像とページネーションの表示をまとめて更新する関数を作成 */
        function updateModalView() {
            modalImage.src = imageSources[currentIndex];
            paginationDots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentIndex);
            });
        }

        /* ★ 追加: 特定のインデックスに直接ジャンプする関数 */
        function jumpToImage(index) {
            currentIndex = index;
            updateModalView();
        }

        // ★ 5. モーダル内で画像を切り替える関数 (矢印クリックやスワイプ用)
        function changeModalImage(direction) {
            currentIndex += direction;
            if (currentIndex < 0) { currentIndex = imageSources.length - 1; }
            else if (currentIndex >= imageSources.length) { currentIndex = 0; }
            updateModalView();
        }

        // 6. メイン画像がクリックされた時の処理
        mainImage.addEventListener('click', (event) => {
            // ★ 追加: ドラッグ操作の直後ならモーダルを開かないようにする
            if (isMainDraggingJustFinished) {
                isMainDraggingJustFinished = false; // フラグをリセット
                return; // 処理を中断
            }
            modal.classList.add('modal-open');
            updateModalView();
        });

        // 7. 閉じるボタンがクリックされた時の処理
        closeButton.addEventListener('click', () => { modal.classList.remove('modal-open'); });
        // 8. モーダルの背景がクリックされた時も閉じる処理
        modal.addEventListener('click', (event) => { if (event.target === modal) { modal.classList.remove('modal-open'); } });
        // ★ 9. モーダル内の矢印がクリックされた時の処理
        modalArrowLeft.addEventListener('click', () => { changeModalImage(-1); });
        modalArrowRight.addEventListener('click', () => { changeModalImage(1); });
        /* --- ★ モーダル用のJavaScriptはここまで --- */

        /* ★★★ ここからモーダル用のスワイプ機能 ★★★ */
        let touchStartX = 0;
        let touchEndX = 0;
        const swipeThreshold = 50;
        modal.addEventListener('touchstart', (event) => { touchStartX = event.touches[0].clientX; });
        modal.addEventListener('touchend', (event) => { touchEndX = event.changedTouches[0].clientX; handleModalSwipe(); });
        function handleModalSwipe() { const swipeDistance = touchEndX - touchStartX; if (swipeDistance < -swipeThreshold) { changeModalImage(1); } else if (swipeDistance > swipeThreshold) { changeModalImage(-1); } }
        let isModalDragging = false;
        modal.addEventListener('mousedown', (event) => { if (event.target === modalImage || event.target.classList.contains('modal-arrow')) { isModalDragging = true; touchStartX = event.clientX; modalImage.style.cursor = 'grabbing'; event.preventDefault(); } });
        modal.addEventListener('mouseup', (event) => { if (isModalDragging) { isModalDragging = false; touchEndX = event.clientX; modalImage.style.cursor = 'grab'; handleModalSwipe(); } });
        modal.addEventListener('mouseleave', (event) => { if (isModalDragging) { isModalDragging = false; touchEndX = event.clientX; modalImage.style.cursor = 'grab'; handleModalSwipe(); } });
        modal.addEventListener('mousemove', (event) => { if (isModalDragging) { event.preventDefault(); } });
        /* ★★★ モーダル用のスワイプ機能はここまで ★★★ */

        /* ★★★ ここからメイン画像用のスワイプ＆ドラッグ機能を追加 ★★★ */
        const mainImageContainer = document.querySelector('.main-image-container');
        let isMainDragging = false;
        let isMainDraggingJustFinished = false; // ドラッグ直後かの判定フラグ
        let mainTouchStartX = 0;
        let mainTouchEndX = 0;

        // メイン画像のスワイプ方向を判定して画像を切り替える関数
        function handleMainSwipe() {
            const swipeDistance = mainTouchEndX - mainTouchStartX;
            if (swipeDistance < -swipeThreshold) {
                changeMainImage(1);
            } else if (swipeDistance > swipeThreshold) {
                changeMainImage(-1);
            }
        }

        // --- スマホ用 ---
        mainImageContainer.addEventListener('touchstart', (event) => {
            mainTouchStartX = event.touches[0].clientX;
        });
        mainImageContainer.addEventListener('touchend', (event) => {
            mainTouchEndX = event.changedTouches[0].clientX;
            handleMainSwipe();
        });

        // --- PC用 ---
        mainImageContainer.addEventListener('mousedown', (event) => {
            isMainDragging = true;
            mainTouchStartX = event.clientX;
            mainImage.style.cursor = 'grabbing';
            event.preventDefault();
        });
        mainImageContainer.addEventListener('mouseup', (event) => {
            if (isMainDragging) {
                isMainDragging = false;
                mainTouchEndX = event.clientX;
                mainImage.style.cursor = 'grab';
                // ドラッグ距離がわずかな場合はスワイプとみなさない
                if (Math.abs(mainTouchEndX - mainTouchStartX) > 10) {
                    isMainDraggingJustFinished = true; // ドラッグ直後フラグを立てる
                    setTimeout(() => { isMainDraggingJustFinished = false; }, 100); // すぐにフラグを解除
                }
                handleMainSwipe();
            }
        });
        mainImageContainer.addEventListener('mouseleave', (event) => {
            if (isMainDragging) {
                isMainDragging = false;
                mainTouchEndX = event.clientX;
                mainImage.style.cursor = 'grab';
                handleMainSwipe();
            }
        });
        mainImageContainer.addEventListener('mousemove', (event) => {
            if (isMainDragging) {
                event.preventDefault();
            }
        });
        /* ★★★ メイン画像用の機能はここまで ★★★ */
    </script>
</body>

</html>